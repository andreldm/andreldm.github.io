{% extends "base.html" %}

{%- block content %}
  <div class="post">
    <header class="post-header">
      <h2 class="post-title">{{ page.title }}</h2>
      <p class="post-meta">
        {% if page.date %} {{ page.date | date(format="%F") }} {% endif %}
        {% if page.extra.tags %} â€¢ {{ page.extra.tags | join(sep=", ") }} {% endif %}</p>
    </header>

    <article class="post-content">
      {{ page.content | safe }}
    </article>

    {% if config.mode == "build" %}
      <div class="show-comments">
        <button id="show-comments-button" onclick="disqus(); return false;">Show Comments (from Disqus)</button>
      </div>

      <div id="disqus_thread"></div>
      <script>
        var disqus_loaded = false;

        var disqus_config = function () {
          this.page.url = 'https://andreldm.com{{ page.path | trim_end_matches(pat='/') | safe }}';
          this.page.identifier = '{{ page.path | trim_end_matches(pat='/') | safe }}';
        };

        function disqus() {
          if (disqus_loaded) return;
          disqus_loaded = true;

          var d = document;
          var s = d.createElement('script');
          s.src = '//andreldm.disqus.com/embed.js';
          s.onerror = () => alert('Failed to load Disqus embedded script, check your anti-tracking settings and try again.');
          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);

          // Hide the button after loading comments
          d.getElementById("show-comments-button").style.display = "none";
        }

        // Load comments when linked to directly
        var hash = window.location.hash.substr(1);
        if (hash.length > 8 && hash.substring(0, 8) == "comment-")
          disqus();

        // Load comments for search engines
        if(/bot|google|baidu|bing|msn|duckduckgo|slurp|yandex/i.test(navigator.userAgent))
          disqus();
      </script>
      <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
    {% endif %}
  </div>
{% endblock content %}
